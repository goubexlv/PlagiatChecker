{% extends 'main-layout.html' %}
    {% load static %} 
    {% block linkcss %}
      {{ block.super }}
       <link rel="stylesheet" href="{% static 'assets/bundles/dropzonejs/dropzone.css' %}">
       <link rel="stylesheet" href="{% static 'assets/bundles/summernote/summernote-bs4.css' %}">
       <link rel="stylesheet" href="{% static 'assets/bundles/datatables/datatables.min.css' %}">
       <link rel="stylesheet" href="{% static 'assets/css/spinner.css' %}">

       <link rel="stylesheet" href="{% static 'assets/bundles/datatables/DataTables-1.10.16/css/dataTables.bootstrap4.min.css' %}">
       <style>
            .buttons-container {
              height : 130px;
              display: flex;
              align-items: center;
              justify-content: center;
            }

            button {
              background: white;
              border: solid 2px black;
              padding: .375em 1.125em;
              font-size: 1rem;
            }

            .button-arounder {
              font-size: 2rem;
              background: hsl(190deg, 30%, 15%);
              color: hsl(190deg, 10%, 95%);
              
              box-shadow: 0 0px 0px hsla(190deg, 15%, 5%, .2);
              transfrom: translateY(0);
              border-top-left-radius: 0px;
              border-top-right-radius: 0px;
              border-bottom-left-radius: 0px;
              border-bottom-right-radius: 0px;
              
              --dur: .15s;
              --delay: .15s;
              --radius: 16px;
              
              transition:
                border-top-left-radius var(--dur) var(--delay) ease-out,
                border-top-right-radius var(--dur) calc(var(--delay) * 2) ease-out,
                border-bottom-right-radius var(--dur) calc(var(--delay) * 3) ease-out,
                border-bottom-left-radius var(--dur) calc(var(--delay) * 4) ease-out,
                box-shadow calc(var(--dur) * 4) ease-out,
                transform calc(var(--dur) * 4) ease-out,
                background calc(var(--dur) * 4) steps(4, jump-end);
            }

              .button-arounder:hover,
              .button-arounder:focus {
                box-shadow: 0 4px 8px hsla(190deg, 15%, 5%, .2);
                transform: translateY(-4px);
                background: hsl(230deg, 50%, 45%);
                border-top-left-radius: var(--radius);
                border-top-right-radius: var(--radius);
                border-bottom-left-radius: var(--radius);
                border-bottom-right-radius: var(--radius);
              }
      
       </style>
    {% endblock %}
{% block content %}
    <!-- breadcrumb -->
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-primary text-white-all">
                <li class="breadcrumb-item"><a href="{% url 'index' %}"><i class="fas fa-tachometer-alt"></i>Acceuil</a></li>
                <li class="breadcrumb-item active" aria-current="page"><a href="#"><i class="far fa-file"></i>Plagiat de 02 Documents</a></li>
                </ol>
            </nav>
        </div>
    </div>
   
     
    <div class="row clearfix">
        <section class="section">
            <div class="section-body">
            <div class="row">
                <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4>Plagiat de 2 Documents</h4>
                    </div>
                    <div class="card-body">
                        <section class="text-center">
                            <div class="row">
                            <div class="col-lg-6 col-md-6 mb-5 mb-md-5 mb-lg-0 position-relative">
                                        <form action="{% url 'upload_file' %}" class="dropzone">
                                            {% csrf_token %}
                                            <div class="fallback">
                                                <input name="file" type="file"/>
                                            </div>
                                        </form>
                                <h6 class="fw-normal mb-0 p-4">Importer le premier document</h6>
                                <div class="vr vr-blurry position-absolute my-0 h-100 d-none d-md-block top-0 end-0"></div>
                            </div>
                        
                            <div class="col-lg-6 col-md-6 mb-5 mb-md-5 mb-lg-0 position-relative">
                                <form action="{% url 'upload_file' %}" class="dropzone" >
                                    {% csrf_token %}
                                    <div class="fallback">
                                        <input name="file" type="file"/>
                                    </div>
                                </form>
                                <h6 class="fw-normal mb-0 p-4">Importer le deuxieme  document</h6>
                                <div class="vr vr-blurry position-absolute my-0 h-100 d-none d-md-block top-0 end-0"></div>
                            </div>
                            <div class="col-lg-12" style="display:flex; align-items:center; justify-content: center;" >
                                <button type="submit" onclick="send_and_check_plagiat()" class="btn btn-primary">Faire le test de plagiat</button>
                            </div>
                            
                            
                            </div>
                        </section>
                    </div> 
                </div>
                </div>
            </div>
            </div> 

            



        </section>
        <div id="loading" class="loading">
            <div id="spinnerMessage">Loading...</div>
        </div>
    </div>
{% endblock %}


{% block scripts %}
    {{ block.super }}

    
    <script src="{% static 'assets/bundles/dropzonejs/min/dropzone.min.js' %}"></script>
    {% comment %} <script src="{% static 'assets/js/page/multiple-upload.js' %}"></script> {% endcomment %}
    <script src="{% static 'assets/bundles/summernote/summernote-bs4.js' %}"></script>
    <script src="{% static 'assets/bundles/datatables/datatables.min.js' %}"></script>
    <script src="{% static 'assets/bundles/datatables/DataTables-1.10.16/js/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'assets/js/page/datatables.js' %}"></script>
    <script src="{% static 'assets/js/sweet.js' %}"></script>
    <script>
        var loadingDiv = document.getElementById('loading');
        var spinnerMessageDiv = document.getElementById('spinnerMessage');
      
        function hideSpinner() {
          loadingDiv.style.visibility = 'hidden';
          spinnerMessageDiv.innerText = '';
      }


        Dropzone.options.mydropzone = {
            paramName: "file", // Le nom du paramètre qui contient le fichier sur le serveur
            maxFilesize: 1000, // Taille maximale du fichier en Mo
            maxFiles: 1, // Limite à un seul fichier
            acceptedFiles: ".pdf, .py, .txt", // Types de fichiers autorisés
            init: function () {
                  this.on("sending", function (file, xhr, formData) {
                    var loadingDiv = document.getElementById('loading');
                    var spinnerMessageDiv = document.getElementById('spinnerMessage');
                    loadingDiv.style.visibility = 'visible';
                    swal("Importation avec success");               
                 });
                this.on("success", function (file, response) {
                   
                   
                    hideSpinner();
                });
                this.on("error", function (file, errorMessage) {
                    hideSpinner();
                    // Réaction en cas d'erreur lors de l'envoi
                    console.error("Erreur lors de l'envoi du document:", errorMessage);
                });
            }
    
        };
        Dropzone.options.mydropzone1 = {
            paramName: "file", // Le nom du paramètre qui contient le fichier sur le serveur
            maxFilesize: 1000, // Taille maximale du fichier en Mo
            maxFiles: 1, // Limite à un seul fichier
            acceptedFiles: ".pdf, .py, .txt", // Types de fichiers autorisés
            init: function () {
                  this.on("sending", function (file, xhr, formData) {
                    var loadingDiv = document.getElementById('loading');
                    var spinnerMessageDiv = document.getElementById('spinnerMessage');
                    loadingDiv.style.visibility = 'visible';
                    swal("Importation avec success");                });
                this.on("success", function (file, response) {
                   
                    hideSpinner();
                });
                this.on("error", function (file, errorMessage) {
                    hideSpinner();
                    // Réaction en cas d'erreur lors de l'envoi
                    console.error("Erreur lors de l'envoi du document:", errorMessage);
                });
            }
    
        };
        function send_and_check_plagiat(){
           
                // Récupérez les fichiers des deux Dropzones
                var dropzone1 = Dropzone.forElement('#mydropzone');
                var dropzone2 = Dropzone.forElement('#mydropzone1');
                var filesFromDropzone1 = dropzone1.getAcceptedFiles();
                var filesFromDropzone2 = dropzone2.getAcceptedFiles();            
        
                // Assurez-vous qu'il n'y a qu'un seul fichier par Dropzone
                
                if (filesFromDropzone1.length === 1 && filesFromDropzone2.length === 1) {
                    
                     console.log(filesFromDropzone1);
                     console.log(filesFromDropzone2);
                    // Créez un objet FormData pour envoyer les fichiers
                    var formData = new FormData();
        
                    // Ajoutez le fichier de la première Dropzone
                    formData.append('fileFromDropzone1', filesFromDropzone1[0]);
        
                    // Ajoutez le fichier de la deuxième Dropzone
                    formData.append('fileFromDropzone2', filesFromDropzone2[0]);
                    var payload = {
                        fileFromDropzone1: filesFromDropzone1[0],
                        fileFromDropzone2: filesFromDropzone2[0],
                    };
                    // Effectuez la requête Ajax
                    console.log(payload);
                    $.ajax({
                        url: "{% url 'plagiat_detection' %}",
                        type: 'POST',
                        data: payload,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            // Gérez la réponse du serveur en cas de succès
                            console.log('Réponse du serveur:', response);
                        },
                        error: function (error) {
                            // Gérez les erreurs de la requête Ajax
                            console.error('Erreur lors de la requête Ajax:', error);
                        }
                    });
                } else {
                    swal("Echec", "Veuillez selectionner 2 fichiers pour faire le test", "error");
                }
        }
    </script>
    {% endblock %} 