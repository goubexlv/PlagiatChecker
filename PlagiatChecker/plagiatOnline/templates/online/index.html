{% extends 'main-layout.html' %}
    {% load static %} 
    {% block linkcss %}
      {{ block.super }}
       <link rel="stylesheet" href="{% static 'assets/bundles/dropzonejs/dropzone.css' %}">
       <link rel="stylesheet" href="{% static 'assets/bundles/summernote/summernote-bs4.css' %}">
       <link rel="stylesheet" href="{% static 'assets/bundles/datatables/datatables.min.css' %}">
       <link rel="stylesheet" href="{% static 'assets/css/spinner.css' %}">

       <link rel="stylesheet" href="{% static 'assets/bundles/datatables/DataTables-1.10.16/css/dataTables.bootstrap4.min.css' %}">
    {% endblock %}
{% block content %}
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-primary text-white-all">
                  <li class="breadcrumb-item"><a href="{% url 'index' %}"><i class="fas fa-tachometer-alt"></i>Acceuil</a></li>
                  <li class="breadcrumb-item active" aria-current="page"><a href="#"><i class="far fa-file"></i>Plagiat en ligne</a></li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row clearfix">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div class="card">
                <div class="card-header">
                     <h3>Plagiat En Ligne</h3>
                </div>
            <div class="card-body">
          <div id="example-basic">
            <h3> Menu D'ajout</h3>
            <section>
              <div class="control-label">Choisir la methode d'ajout</div>
              <div class="form-group" style="text-align:center;">
                <label class="custom-switch mt-2">
                  <span class="custom-switch-description"> Uploader un document &nbsp;</span>
                  <input type="checkbox" name="custom-switch-checkbox" class="custom-switch-input" checked>
                  <span class="custom-switch-indicator"></span>
                  <span class="custom-switch-description">Ecrire le texte </span>
                </label>
              </div>
                <p>
                  <div id="dropimport">
                      <form action="{% url 'upload_file' %}" class="dropzone" id="mydropzone">
                        {% csrf_token %}
                          <div class="fallback">
                              <input name="file" type="file"/>
                          </div>
                      </form>
                  </div>
                  <div id="dropEcrire">
                    <div class="form-group row mb-4">
                        <label class="col-form-label text-md-right col-12 col-md-3 col-lg-3">Content</label>
                        <div class="col-sm-12 col-md-7">
                          <textarea class="summernote-simple"></textarea>
                        </div>
                      </div>
                      <div class="form-group row mb-4">
                        <label class="col-form-label text-md-right col-12 col-md-3 col-lg-3"></label>
                    </div>
                  </div>
                </p>
            </section>
            <h3>Extraire</h3>
            <section>
                <p>
                  <div id="pdfContent"></div>
                </p>      
            </section>
            <h3>Pagiat</h3>
            <section>
                <p>
                  <div style="text-align:center; margin:0 auto;">
                    <div class="container">
                      <div id="loading" class="loading" onClick="hideSpinner()">
                        <div id="spinnerMessage">Loading...</div>
                      </div>
                      {% comment %} <form method="GET" action="{% url 'check_plagiat' %}">
                        <input type="hidden" name="text" id="">
                      </form> {% endcomment %}
                      <button class="btn btn-icon icon-left btn-success"  onClick="showSpinner()" id="send_plagiat"><i class="fas fa-check"></i> Start plagiat Online</button>
                  </div>
                  
                </p>
            </section>
            <h3>Rapport et Statistiques</h3>
            <section>
                <p>
                  <div class="row">
                    <div class="col-12">
                      <div class="card">
                        <div class="card-header">
                          <h4>Table With State Save</h4>
                        </div>
                        <div class="card-body">
                          <div class="table-responsive">
                            <table class="table table-striped table-hover" id="save-stage" style="width:100%;">
                              <thead>
                                <tr>
                                  <th>Name</th>
                                  <th>Position</th>
                                  <th>Office</th>
                                  <th>Age</th>
                                  <th>Start date</th>
                                  <th>Salary</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td>Tiger Nixon</td>
                                  <td>System Architect</td>
                                  <td>Edinburgh</td>
                                  <td>61</td>
                                  <td>2011/04/25</td>
                                  <td>$320,800</td>
                                </tr>
                                <tr>
                                  <td>Garrett Winters</td>
                                  <td>Accountant</td>
                                  <td>Tokyo</td>
                                  <td>63</td>
                                  <td>2011/07/25</td>
                                  <td>$170,750</td>
                                </tr>
                                <tr>
                                  <td>Ashton Cox</td>
                                  <td>Junior Technical Author</td>
                                  <td>San Francisco</td>
                                  <td>66</td>
                                  <td>2009/01/12</td>
                                  <td>$86,000</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                </p>
            </section>
        </div>

            </div>
          </div>
        </div>
      </div>
{% endblock %}

{% block scripts %}
    {{ block.super }}

    <script>
        $("#example-basic").steps({
          headerTag: "h3",
          bodyTag: "section",
          transitionEffect: "slideLeft",
          autoFocus: true
        });

        $('#dropimport').hide();
        $('#dropEcrire').show();

        $('.custom-switch-input').change(function() {
          if(this.checked){
            $('#dropimport').hide();
            $('#dropEcrire').show();
          } else {
            $('#dropimport').show();
            $('#dropEcrire').hide();
          }
        });
        
    </script>
        
    <script src="{% static 'assets/bundles/dropzonejs/min/dropzone.min.js' %}"></script>
    {% comment %} <script src="{% static 'assets/js/page/multiple-upload.js' %}"></script> {% endcomment %}
    <script src="{% static 'assets/bundles/summernote/summernote-bs4.js' %}"></script>
    <script src="{% static 'assets/bundles/datatables/datatables.min.js' %}"></script>
    <script src="{% static 'assets/bundles/datatables/DataTables-1.10.16/js/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'assets/js/page/datatables.js' %}"></script>

    <script>
      var text = "";
      Dropzone.options.mydropzone = {
        paramName: "file", // Le nom du paramètre qui contient le fichier sur le serveur
        maxFilesize: 1000, // Taille maximale du fichier en Mo
        acceptedFiles: ".pdf, .doc, .docx , .py", // Types de fichiers autorisés
        init: function () {
            this.on("success", function (file, response) {
              console.log(1);
              console.log(response);
                // Réaction en cas de succès de l'envoi
                text = response.result.result;
                $("#pdfContent").text(response.result.result);
              });
            this.on("error", function (file, errorMessage) {
                // Réaction en cas d'erreur lors de l'envoi
                console.error("Erreur lors de l'envoi du document:", errorMessage);
            });
        }
    };
    var loadingDiv = document.getElementById('loading');
    var spinnerMessageDiv = document.getElementById('spinnerMessage');

    function showSpinner() {
        loadingDiv.style.visibility = 'visible';
        spinnerMessageDiv.innerText = 'Loading...';
        var csrfToken = document.cookie.match(/csrftoken=([^ ;]+)/)[1];

        // Utilisez la valeur de #pdfContent comme paramètre dans la requête AJAX
        $.ajax({
            method: "POST",
            url: "{% url 'check_plagiat' %}",
            headers: {
              "X-CSRFToken": csrfToken
            },
          data: text,
          success: function(data) {
            console.log(data);
            // Faites quelque chose avec les données renvoyées si nécessaire
          }, error: function(jqXHR, textStatus, errorThrown) {
            console.error('Erreur lors de la requête AJAX:', textStatus, errorThrown);
            // Gérez l'erreur côté client (par exemple, affichez un message d'erreur)
            spinnerMessageDiv.innerText = 'Erreur lors de la requête AJAX';
        },
        complete: function() {
            // Cacher le spinner une fois que la requête est terminée (que ce soit un succès ou un échec)
            hideSpinner();
        }
          })
          
         /* ).done(function (response) {
            console.log(response)
          
        })
        .fail(function (response) {
            console.log(response)
        })*/
        
        
       /*$.ajax({
            type: 'GET',
            url: "check_plagiat/" + text,
            success: function(data) {
                console.log(data);
                // Faites quelque chose avec les données renvoyées si nécessaire
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Erreur lors de la requête AJAX:', textStatus, errorThrown);
                // Gérez l'erreur côté client (par exemple, affichez un message d'erreur)
                spinnerMessageDiv.innerText = 'Erreur lors de la requête AJAX';
            },
            complete: function() {
                // Cacher le spinner une fois que la requête est terminée (que ce soit un succès ou un échec)
                hideSpinner();
            }
        });*/
    }

    function hideSpinner() {
        loadingDiv.style.visibility = 'hidden';
        spinnerMessageDiv.innerText = '';
    }
    </script>

   
    
{% endblock %} 


